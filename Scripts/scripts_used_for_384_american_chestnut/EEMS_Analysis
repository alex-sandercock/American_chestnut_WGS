##Methods for EEMS
##EEMS was first built and compiled per the software manual

#Step 1: Prepare plink bed file from SNP VCF (DO NOT USE A LD PRUNED DATASET - LD is needed for EEMS calculations)

$HOME/bin/plink2 \
        --vcf /work/C_dentata_WGS/dentata_356_filtered/SMC++/American_chestnut_356_snps_only_filtered_remove_fail_miss_0.9.vcf.gz \
        --make-bed \
	--const-fid 0 \
        --allow-extra-chr \
	--max-alleles 2 \
	--autosome \
        --out plink_356_filtered

#Step 2: Convert plink bed file to EEMS .diffs file using bed2diffs

$HOME/bin/eems/bed2diffs/src/bed2diffs_v1 --bfile ./test/example-SNP-major-mode --nthreads 12

#Step 3: Create habitat coordinates file (datapath.outer)

Go to http://www.birdtheme.org/useful/v3tool.html and click around habitat area to get vertices. 
#The habitat vertices should be listed counterclockwise and the first vertex should also be the last vertex, so that the outline is a closed ring

#Step 4: Create file with sample coordinates (datapath.coord)
#Make sure the coordinates are in the same order as the plink .fam file!
It is just a file with lat and long.

#Step 5: Create parameter file for EEMS

datapath = /work/C_dentata_WGS/dentata_356_filtered/EEMS/plink_356_filtered
mcmcpath = /work/C_dentata_WGS/dentata_356_filtered/EEMS/results/plink_356_filtered_EEMS_default
nIndiv = 356
nSites = 21116005
nDemes = 200
diploid = true
numMCMCIter = 2000000
numBurnIter = 1000000
numThinIter = 9999

#Step 6: Run EEMS

./runeems_snps --params parameter_paper_defaults.ini

#Step 7: Plot EEMS in R

Refer to README in plotting folder in EEMS

##################PARAMETER SETTINGS USED FOR ANALYSIS##########

#The following demes, 200, 350, 500, and 650 were each run 3 times with new random seed (3 chains per deme)
#The 3 chains were then used to check for convergene in the rEEMSPlot R package and the demes were compared. (instructions in EEMS-docs)

#1: Authors said they use at least 8 million mcmc iterations and never more than 1000 demes (they only used 180-520 demes in paper)
datapath = /work/C_dentata_WGS/dentata_356_filtered/EEMS/plink_356_filtered
mcmcpath = /work/C_dentata_WGS/dentata_356_filtered/EEMS/results/plink_356_filtered_EEMS_default
nIndiv = 356
nSites = 21116005
nDemes = 650
diploid = true
numMCMCIter = 20000000
numBurnIter = 2000000
numThinIter = 9999
mEffctProposalS2 = 0.2
mrateMuProposal = 0.002